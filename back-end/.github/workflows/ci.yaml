name: Node.js CI Pipeline

on:
  push:
    branches:
      - main   # Ch·∫°y khi c√≥ thay ƒë·ªïi tr√™n nh√°nh main
  pull_request:
    branches:
      - main   # Ch·∫°y khi c√≥ Pull Request t·ªõi nh√°nh main

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      # B∆∞·ªõc 1: Checkout m√£ ngu·ªìn
      - name: Checkout code
        uses: actions/checkout@v3

      # B∆∞·ªõc 2: Thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 16 # Thay b·∫±ng phi√™n b·∫£n Node.js ph√π h·ª£p v·ªõi d·ª± √°n c·ªßa b·∫°n

      # B∆∞·ªõc 3: C√†i ƒë·∫∑t c√°c dependency
      - name: Install dependencies
        run: npm install

      # B∆∞·ªõc 4: Ki·ªÉm tra c√∫ ph√°p m√£ ngu·ªìn v·ªõi ESLint
      - name: Lint code
        run: npm run lint

      # B∆∞·ªõc 5: Ch·∫°y unit tests
      - name: Run tests
        run: npm test

      # B∆∞·ªõc 6: T·∫°o th√¥ng b√°o Pull Request (ch·ªâ √°p d·ª•ng v·ªõi pull_request)
      - name: Post PR Comment
        if: ${{ github.event_name == 'pull_request' }}
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          header: Lint & Test Results
          message: |
            - **Lint:** Success üéâ  
            - **Tests:** All tests passed ‚úîÔ∏è  
